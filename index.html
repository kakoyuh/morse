<!doctype html>
<html lang="zh-Hant">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Morse Beat</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=SF+Pro+Display:wght@400;600&display=swap');

* { box-sizing: border-box; font-family: "SF Pro Display", -apple-system, BlinkMacSystemFont, sans-serif; }
body {
  background: linear-gradient(180deg, #f2f4f7, #dce3ea);
  min-height: 100vh; display: flex; justify-content: center; align-items: center; padding: 20px;
  transition: background 0.3s ease; background-size: cover; background-position: center; background-repeat: no-repeat;
}
.container { display: flex; flex-wrap: wrap; justify-content: center; gap: 20px; }
.card {
  backdrop-filter: blur(20px); background: rgba(255, 255, 255, 0.6); border-radius: 30px;
  box-shadow: 0 4px 30px rgba(0,0,0,0.1); padding: 30px; width: 340px; text-align: center; transition: all 0.3s ease;
}
h1,h2 { font-weight: 600; color: #007AFF; margin-bottom: 15px; }
input,textarea {
  width: 100%; padding: 12px; border-radius: 15px; border: 1px solid rgba(0,0,0,0.1);
  outline: none; margin-bottom: 15px; font-size: 16px; resize: none; text-align: center;
  background: rgba(255,255,255,0.4);
}
.output {
  font-size: 18px; color: #333; background: rgba(255,255,255,0.4);
  border-radius: 15px; padding: 15px; margin-bottom: 15px; min-height: 40px; transition: all 0.3s ease; word-wrap: break-word;
}
button {
  background: #007AFF; color: white; border: none; border-radius: 15px;
  padding: 10px 20px; font-size: 15px; margin: 5px; cursor: pointer; transition: all 0.2s ease;
}
button:hover { background: #005ecb; }
.copy-btn { background: #34C759; } .copy-btn:hover { background: #248a3d; }
.share-btn { background: #FF9500; } .share-btn:hover { background: #cc7a00; }
.flash { animation: flash 0.2s ease; }
@keyframes flash { 0% { background-color: #007aff33; } 100% { background-color: transparent; } }
.toast {
  position: fixed; bottom: 80px; left: 50%; transform: translateX(-50%) translateY(30px);
  background: rgba(255,255,255,0.65); backdrop-filter: blur(20px); border-radius: 25px;
  box-shadow: 0 8px 20px rgba(0,0,0,0.15); color: #000; padding: 12px 28px; font-size: 15px;
  font-weight: 500; opacity: 0; pointer-events: none; transition: all 0.4s ease;
}
.toast.show { opacity: 1; transform: translateX(-50%) translateY(0); }
.bg-upload {
  position: fixed; top: 20px; right: 20px; backdrop-filter: blur(20px);
  background: rgba(255,255,255,0.5); border-radius: 25px; padding: 10px 15px;
  box-shadow: 0 4px 15px rgba(0,0,0,0.1); cursor: pointer; font-weight: 500; transition: all 0.2s ease;
}
.bg-upload:hover { background: rgba(255,255,255,0.7); }
</style>
</head>
<body>

<label class="bg-upload">ä¸Šå‚³èƒŒæ™¯<input type="file" id="bgInput" style="display:none;" accept="image/*"></label>

<div class="container">

  <!-- ç·¨ç¢¼å€ -->
  <div class="card">
    <h1>ğŸµ Morse Beat</h1>
    <input type="text" id="textInput" placeholder="è¼¸å…¥æ–‡å­—..." />
    <div class="output" id="morseOutput">ç­‰å¾…è¼¸å…¥...</div>
    <div>
      <button id="convertBtn">è½‰æ›</button>
      <button id="playBtn">æ’­æ”¾ç¯€å¥</button>
      <button id="stopBtn">åœæ­¢</button>
      <button class="copy-btn" onclick="copyText('morseOutput')">è¤‡è£½æ‘©æ–¯ç¢¼</button>
      <button class="share-btn" onclick="shareText('morseOutput')">åˆ†äº«æ‘©æ–¯ç¢¼</button>
    </div>
  </div>

  <!-- è§£ç¢¼å€ -->
  <div class="card">
    <h2>ğŸ” è§£ç¢¼å€</h2>
    <textarea id="decodeInput" rows="4" placeholder="è¼¸å…¥æ‘©æ–¯ç¢¼ï¼ˆä¾‹å¦‚ï¼š.... . .-.. .-.. ---ï¼‰"></textarea>
    <div class="output" id="decodeOutput">ç­‰å¾…è§£ç¢¼...</div>
    <div>
      <button id="decodeBtn">è§£ç¢¼</button>
      <button class="copy-btn" onclick="copyText('decodeOutput')">è¤‡è£½è§£ç¢¼æ–‡å­—</button>
      <button class="share-btn" onclick="shareText('decodeOutput')">åˆ†äº«æ–‡å­—</button>
    </div>
  </div>

</div>

<div id="toast" class="toast">âœ… å·²è¤‡è£½ï¼</div>

<script>
// æ‘©æ–¯ç¢¼é‚è¼¯
const textInput=document.getElementById("textInput");
const morseOutput=document.getElementById("morseOutput");
const convertBtn=document.getElementById("convertBtn");
const playBtn=document.getElementById("playBtn");
const stopBtn=document.getElementById("stopBtn");

const decodeInput=document.getElementById("decodeInput");
const decodeOutput=document.getElementById("decodeOutput");
const decodeBtn=document.getElementById("decodeBtn");

const morseCode={A:".-",B:"-...",C:"-.-.",D:"-..",E:".",F:"..-.",G:"--.",H:"....",I:"..",J:".---",K:"-.-",L:".-..",M:"--",N:"-.",O:"---",P:".--.",Q:"--.-",R:".-.",S:"...",T:"-",U:"..-",V:"...-",W:".--",X:"-..-",Y:"-.--",Z:"--..","1":".----","2":"..---","3":"...--","4":"....-","5":".....","6":"-....","7":"--...","8":"---..","9":"----.","0":"-----"," ":"/"};
const morseToText={}; for(let k in morseCode)morseToText[morseCode[k]]=k;

let audioCtx, playing=false;
function textToMorse(t){return t.toUpperCase().split("").map(c=>morseCode[c]||"").join(" ");}
function morseToEnglish(m){return m.split(" / ").map(w=>w.split(" ").map(s=>morseToText[s]||"").join("")).join(" ");}

convertBtn.addEventListener("click",()=>{morseOutput.textContent=textToMorse(textInput.value.trim())||"ï¼ˆç„¡æ•ˆè¼¸å…¥ï¼‰";});
decodeBtn.addEventListener("click",()=>{decodeOutput.textContent=morseToEnglish(decodeInput.value.trim())||"ï¼ˆç„¡æ•ˆæ‘©æ–¯ç¢¼ï¼‰";});

function playMorse(m){
  if(!m||playing)return;
  playing=true;
  audioCtx=new(window.AudioContext||window.webkitAudioContext)();
  const unit=0.15; let time=audioCtx.currentTime;
  m.split("").forEach(s=>{
    if(s==="."){beep(time,unit);flash();time+=unit*2;}
    else if(s==="-"){beep(time,unit*3);flash();time+=unit*4;}
    else if(s===" ")time+=unit*2;
    else if(s==="/")time+=unit*6;
  });
  setTimeout(()=>{playing=false;},(time-audioCtx.currentTime)*1000);
}
function beep(start,d){const o=audioCtx.createOscillator(),g=audioCtx.createGain();o.type="sine";o.frequency.setValueAtTime(600,audioCtx.currentTime);o.connect(g);g.connect(audioCtx.destination);o.start(start);o.stop(start+d);}
function flash(){morseOutput.classList.add("flash"); setTimeout(()=>morseOutput.classList.remove("flash"),100);}

playBtn.addEventListener("click",()=>{const m=morseOutput.textContent.trim();if(m&&m!=="ç­‰å¾…è¼¸å…¥...")playMorse(m);});
stopBtn.addEventListener("click",()=>{if(audioCtx)audioCtx.close();playing=false;});

// è¤‡è£½èˆ‡ Toast
function copyText(id){const t=document.getElementById(id).textContent.trim();if(!t||t==="ç­‰å¾…è¼¸å…¥..."||t==="ç­‰å¾…è§£ç¢¼...")return;navigator.clipboard.writeText(t);showToast("âœ… å·²è¤‡è£½ï¼");}
function showToast(msg){const toast=document.getElementById("toast");toast.textContent=msg;toast.classList.add("show");setTimeout(()=>toast.classList.remove("show"),1500);}

// åˆ†äº«åŠŸèƒ½
function shareText(id){
  const text=document.getElementById(id).textContent.trim();
  if(!text||text==="ç­‰å¾…è¼¸å…¥..."||text==="ç­‰å¾…è§£ç¢¼...") return;
  const url=window.location.origin+window.location.pathname+"?share="+encodeURIComponent(text);

  if(navigator.share){
    navigator.share({title:"Morse Beat åˆ†äº«", text:text, url:url});
  } else {
    // fallback: æ‰“é–‹ç¤¾ç¾¤åˆ†äº«é¸é …
    const shareLink=prompt("è¤‡è£½åˆ†äº«é€£çµ:",url);
    if(shareLink) showToast("ğŸ”— åˆ†äº«é€£çµå·²è¤‡è£½ï¼");
  }
}

// èƒŒæ™¯ä¸Šå‚³
const bgInput=document.getElementById("bgInput");
bgInput.addEventListener("change",e=>{
  const file=e.target.files[0];
  if(file){
    const reader=new FileReader();
    reader.onload=function(ev){document.body.style.backgroundImage=`url(${ev.target.result})`;localStorage.setItem("bgImage",ev.target.result);}
    reader.readAsDataURL(file);
  }
});
const bgData=localStorage.getItem("bgImage");
if(bgData) document.body.style.backgroundImage=`url(${bgData})`;

// å¦‚æœç¶²å€å¸¶ share åƒæ•¸ï¼Œè‡ªå‹•å¡«å…¥æ‘©æ–¯ç¢¼
const params=new URLSearchParams(window.location.search);
if(params.has("share")){
  const shared=params.get("share");
  morseOutput.textContent=shared;
}

</script>
</body>
</html>

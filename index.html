<!doctype html>
<html lang="zh-Hant">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="google-adsense-account" content="ca-pub-6741848109234929">
<title>Morse Beat</title>
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6741848109234929"
     crossorigin="anonymous"></script>
<style>
@import url("https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&display=swap");

/* ================== 通用 ================== */
* { box-sizing: border-box; font-family: "Poppins", sans-serif; margin: 0; padding: 0; }
body {
  background: radial-gradient(circle at top, #1a1a1a, #0e0e0e);
  background-size: cover;
  background-position: center;
  background-attachment: fixed;
  color: #fff;
  min-height: 100vh;
  display: flex;
  justify-content: center;
  align-items: flex-start;
  padding: 40px 20px;
  overflow-x: hidden;
}

/* ================== 容器 ================== */
.container {
  display: flex;
  flex-wrap: wrap;
  justify-content: center;
  gap: 25px;
  width: 100%;
  max-width: 1000px;
  z-index: 2;
  position: relative;
}

/* ================== 卡片 ================== */
.card {
  background: rgba(255, 255, 255, 0.08);
  border: 1px solid rgba(255, 255, 255, 0.12);
  border-radius: 20px;
  backdrop-filter: blur(15px);
  box-shadow: 0 4px 30px rgba(0, 0, 0, 0.35);
  padding: 25px;
  width: 320px;
  text-align: center;
  transition: all 0.3s ease;
  z-index: 2;
}
.card:hover { transform: translateY(-5px); }

h1, h2 {
  font-weight: 600;
  margin-bottom: 15px;
  background: linear-gradient(90deg, #00ccff, #00ffaa);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
}

input, textarea {
  width: 100%;
  padding: 12px;
  border-radius: 10px;
  border: none;
  outline: none;
  font-size: 15px;
  resize: none;
  text-align: center;
  background: rgba(255,255,255,0.08);
  color: #fff;
  margin-bottom: 15px;
}

.output {
  background: rgba(0,0,0,0.4);
  border-radius: 10px;
  padding: 15px;
  min-height: 50px;
  color: #aef;
  font-size: 16px;
  margin-bottom: 15px;
  word-break: break-word;
}

button {
  background: linear-gradient(135deg, #00aaff, #00ffaa);
  border: none;
  border-radius: 10px;
  padding: 10px 16px;
  color: #000;
  font-weight: 600;
  margin: 5px;
  cursor: pointer;
  transition: all 0.2s ease;
}
button:hover { background: linear-gradient(135deg, #00ccff, #00ffcc); transform: scale(1.05); }

.copy-btn { background: linear-gradient(135deg, #34C759, #4cd964); }
.copy-btn:hover { background: linear-gradient(135deg, #28a745, #34c759); }
.share-btn { background: linear-gradient(135deg, #ff9500, #ffaa33); }
.share-btn:hover { background: linear-gradient(135deg, #cc7a00, #ff9500); }

.flash { animation: flash 0.2s ease; }
@keyframes flash { 0% { background-color: #00ffaa33; } 100% { background-color: transparent; } }

.toast {
  position: fixed;
  bottom: 60px;
  left: 50%;
  transform: translateX(-50%) translateY(30px);
  background: rgba(255,255,255,0.15);
  border: 1px solid rgba(255,255,255,0.1);
  backdrop-filter: blur(15px);
  color: #fff;
  padding: 12px 25px;
  border-radius: 25px;
  opacity: 0;
  transition: all 0.4s ease;
  font-size: 15px;
  z-index: 999;
}
.toast.show { opacity: 1; transform: translateX(-50%) translateY(0); }

/* ================== 背景上傳區 ================== */
.upload-card img { width: 100%; margin-top: 10px; border-radius: 12px; display: none; }

/* ================== 廣告 ================== */
.ad {
  position: fixed;
  top: 50%;
  transform: translateY(-50%);
  width: 120px;
  height: 300px;
  background: rgba(255,255,255,0.08);
  border: 1px solid rgba(255,255,255,0.12);
  border-radius: 20px;
  backdrop-filter: blur(15px);
  text-align: center;
  padding: 15px;
  color: #fff;
  z-index: 1;
}
.ad-left { left: 10px; }
.ad-right { right: 10px; }

@media(max-width:767px){
  .ad { display: none; }
  .card { width: 90%; }
  .upload-card { order: -1; margin-bottom: 20px; width: 90%; }
}

/* ================== 上傳區 RWD ================== */
@media(min-width:768px){
  .upload-card {
    position: fixed;
    bottom: 20px;
    right: 20px;
    width: 250px;
  }
}

/* ================== Footer ================== */
footer {
  width: 100%;
  text-align: center;
  padding: 15px 0;
  color: #fff;
  position: fixed;
  bottom: 0;
  left: 0;
  background: rgba(0,0,0,0.4);
  backdrop-filter: blur(10px);
  font-size: 14px;
  z-index: 2;
}
</style>
</head>
<body>

<!-- 桌面廣告 -->
<div class="ad ad-left">廣告左</div>
<div class="ad ad-right">廣告右</div>

<div class="container">

  <!-- 編碼區 -->
  <div class="card">
    <h1>🎵 Morse Beat</h1>
    <input type="text" id="textInput" placeholder="輸入文字..." />
    <div class="output" id="morseOutput">等待輸入...</div>
    <div>
      <button id="convertBtn">轉換</button>
      <button id="playBtn">播放節奏</button>
      <button id="stopBtn">停止</button>
      <button class="copy-btn" onclick="copyText('morseOutput')">複製摩斯碼</button>
      <button class="share-btn" onclick="shareText('morseOutput')">分享摩斯碼</button>
    </div>
  </div>

  <!-- 解碼區 -->
  <div class="card">
    <h2>🔍 解碼區</h2>
    <textarea id="decodeInput" rows="4" placeholder="輸入摩斯碼（例如：.... . .-.. .-.. ---）"></textarea>
    <div class="output" id="decodeOutput">等待解碼...</div>
    <div>
      <button id="decodeBtn">解碼</button>
      <button class="copy-btn" onclick="copyText('decodeOutput')">複製解碼文字</button>
      <button class="share-btn" onclick="shareText('decodeOutput')">分享文字</button>
    </div>
  </div>

  <!-- 背景上傳區 -->
  <div class="card upload-card">
    <h2>🖼 上傳背景</h2>
    <input type="file" id="bgInput" accept="image/*" />
    <img id="preview">
  </div>

</div>

<div id="toast" class="toast">✅ 已複製！</div>

<footer>© 2025 MorseBeat</footer>

<script>
// ===== 摩斯碼邏輯 =====
const textInput = document.getElementById("textInput");
const morseOutput = document.getElementById("morseOutput");
const convertBtn = document.getElementById("convertBtn");
const playBtn = document.getElementById("playBtn");
const stopBtn = document.getElementById("stopBtn");
const decodeInput = document.getElementById("decodeInput");
const decodeOutput = document.getElementById("decodeOutput");
const decodeBtn = document.getElementById("decodeBtn");

const MORSE = {
  A: ".-", B: "-...", C: "-.-.", D: "-..", E: ".", F: "..-.", G: "--.", H: "....",
  I: "..", J: ".---", K: "-.-", L: ".-..", M: "--", N: "-.", O: "---",
  P: ".--.", Q: "--.-", R: ".-.", S: "...", T: "-", U: "..-", V: "...-", W: ".--",
  X: "-..-", Y: "-.--", Z: "--..",
  "1": ".----", "2": "..---", "3": "...--", "4": "....-", "5": ".....",
  "6": "-....", "7": "--...", "8": "---..", "9": "----.", "0": "-----", " ": "/"
};
const REVERSE = Object.fromEntries(Object.entries(MORSE).map(([k,v]) => [v,k]));

let audioCtx, playing=false;
function textToMorse(t){return t.toUpperCase().split("").map(c=>MORSE[c]||"").join(" "); }
function morseToText(m){return m.split(" / ").map(w=>w.split(" ").map(s=>REVERSE[s]||"").join("")).join(" ");}

convertBtn.onclick = ()=>{ morseOutput.textContent = textToMorse(textInput.value.trim()) || "（無效輸入）"; };
decodeBtn.onclick = ()=>{ decodeOutput.textContent = morseToText(decodeInput.value.trim()) || "（無效摩斯碼）"; };

function playMorse(m){
  if(!m||playing)return;
  playing=true;
  audioCtx=new(window.AudioContext||window.webkitAudioContext)();
  const unit=0.15; let time=audioCtx.currentTime;
  m.split("").forEach(s=>{
    if(s==="."){beep(time,unit);flash();time+=unit*2;}
    else if(s==="-"){beep(time,unit*3);flash();time+=unit*4;}
    else if(s===" ")time+=unit*2;
    else if(s==="/")time+=unit*6;
  });
  setTimeout(()=>playing=false,(time-audioCtx.currentTime)*1000);
}
function beep(start,d){
  const o=audioCtx.createOscillator(),g=audioCtx.createGain();
  o.type="sine"; o.frequency.setValueAtTime(600,audioCtx.currentTime);
  o.connect(g); g.connect(audioCtx.destination);
  o.start(start); o.stop(start+d);
}
function flash(){
  morseOutput.classList.add("flash");
  setTimeout(()=>morseOutput.classList.remove("flash"),100);
}
playBtn.onclick=()=>{const m=morseOutput.textContent.trim(); if(m&&m!=="等待輸入...") playMorse(m);};
stopBtn.onclick=()=>{if(audioCtx)audioCtx.close(); playing=false;};

// ===== 複製與分享 =====
function copyText(id){
  const t=document.getElementById(id).textContent.trim();
  if(!t||t.startsWith("等待"))return;
  navigator.clipboard.writeText(t);
  showToast("✅ 已複製！");
}
function shareText(id){
  const t=document.getElementById(id).textContent.trim();
  if(!t||t.startsWith("等待"))return;
  const url=location.origin+location.pathname+"?share="+encodeURIComponent(t);
  if(navigator.share) navigator.share({title:"Morse Beat",text:t,url});
  else { prompt("複製分享連結：",url); showToast("🔗 分享連結已複製！"); }
}
function showToast(msg){
  const toast=document.getElementById("toast");
  toast.textContent=msg; toast.classList.add("show");
  setTimeout(()=>toast.classList.remove("show"),1500);
}

// ===== 背景上傳 =====
document.getElementById("bgInput").addEventListener("change", e=>{
  const file=e.target.files[0];
  if(!file) return;
  const reader=new FileReader();
  reader.onload = ev => {
    document.body.style.backgroundImage = `url(${ev.target.result})`;
  };
  reader.readAsDataURL(file);
});

// ===== URL 分享自動解碼 =====
const params=new URLSearchParams(window.location.search);
if(params.has("share")){
  const shared=params.get("share");
  decodeInput.value=shared;
  decodeOutput.textContent=morseToText(shared) || "（無效摩斯碼）";
}
</script>
</body>
</html>


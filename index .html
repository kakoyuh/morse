<!doctype html>
<html lang="zh-Hant">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description" content="Morse Beatï¼šçµåˆæ‘©æ–¯ç¢¼èˆ‡éŸ³æ¨‚ç¯€å¥çš„å‰µæ„å·¥å…·ã€‚è¼¸å…¥æ–‡å­—å³å¯è½‰æ›æˆæ‘©æ–¯ç¯€æ‹ï¼Œä¸¦å¯åˆ†äº«ç‚ºé©šå–œé€£çµï¼ˆéœ€æŒ‰è§£ç¢¼æ‰èƒ½é¡¯ç¤ºå…§å®¹ï¼‰ã€‚">
<meta name="keywords" content="æ‘©æ–¯ç¢¼,Morse code,æ‘©æ–¯ç¯€å¥,å¯†ç¢¼å·¥å…·,ç·šä¸Šæ‘©æ–¯ç¢¼è½‰æ›å™¨,è¨Šè™ŸéŸ³æ¨‚">
<title>Morse Beat</title>

<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6741848109234929" crossorigin="anonymous"></script>

<style>
@import url("https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&display=swap");
*{box-sizing:border-box;font-family:"Poppins",sans-serif;margin:0;padding:0}
html,body{height:100%}
body{background:radial-gradient(circle at top,#0b0b0b,#050505);color:#fff;min-height:100vh;display:flex;flex-direction:column;align-items:center;padding-top:80px;overflow-x:hidden}

/* å»£å‘Š */
.ad-top,.ad-bottom{width:100%;text-align:center;margin:10px 0}
.ad-left,.ad-right{position:fixed;top:50%;transform:translateY(-50%);width:120px;height:300px;text-align:center;background:rgba(255,255,255,0.04);border-radius:15px;display:flex;align-items:center;justify-content:center;z-index:1}
.ad-left{left:10px}
.ad-right{right:10px}

/* container */
.container{max-width:1200px;display:flex;flex-wrap:wrap;justify-content:center;gap:25px;z-index:2;position:relative;padding:20px}
.card{background:rgba(255,255,255,0.04);border-radius:20px;backdrop-filter:blur(12px);box-shadow:0 4px 30px rgba(0,0,0,0.5);padding:25px;width:320px;text-align:center;transition:all 0.3s ease}
.card:hover{transform:translateY(-5px)}
h1,h2{font-weight:600;background:linear-gradient(90deg,#00ccff,#00ffaa);-webkit-background-clip:text;-webkit-text-fill-color:transparent;margin-bottom:15px}
input,textarea{width:100%;padding:12px;border-radius:10px;border:none;outline:none;font-size:15px;margin-bottom:15px;background:rgba(255,255,255,0.06);color:#fff;text-align:center;resize:none}
.output{
    background:rgba(0,0,0,0.45);
    border-radius:10px;
    padding:15px;
    min-height:50px;
    color:#aef;
    font-size:16px;
    margin-bottom:15px;
    word-break:break-word;
    /* FIX: ç¢ºä¿ç©ºæ ¼è¢«æ­£ç¢ºé¡¯ç¤º */
    white-space: pre-wrap; 
}
button{background:linear-gradient(135deg,#00aaff,#00ffaa);border:none;border-radius:10px;padding:10px 16px;color:#000;font-weight:600;margin:5px;cursor:pointer;transition:all .2s ease}
button:hover{transform:scale(1.05)}
.copy-btn{background:linear-gradient(135deg,#34C759,#4cd964)}
.share-btn{background:linear-gradient(135deg,#ff9500,#ffaa33)}
.flash{animation: flash 0.2s ease}
@keyframes flash{0%{background-color:#00ffaa33}100%{background-color:transparent}}

.toast{position:fixed;bottom:60px;left:50%;transform:translateX(-50%) translateY(30px);background:rgba(255,255,255,0.12);border:1px solid rgba(255,255,255,0.06);backdrop-filter:blur(15px);color:#fff;padding:12px 25px;border-radius:25px;opacity:0;transition:all .4s ease;font-size:15px}
.toast.show{opacity:1;transform:translateX(-50%) translateY(0)}

/* æ‘©æ–¯è¼¸å…¥æŒ‰éˆ• */
#beatBtn{padding:15px 25px;font-size:18px;}
/* å„ªåŒ–ï¼šæŒ‰éˆ•æŒ‰ä¸‹çš„å³æ™‚åé¥‹ */
#beatBtn.active{
    background: linear-gradient(135deg, #00ffaa, #00aaff); /* åè½‰æ¼¸å±¤ */
    transform: scale(0.95);
}

/* New Timer Progress Bar Styles */
#timerProgressContainer {
    height: 6px;
    background: rgba(255, 255, 255, 0.1);
    border-radius: 3px;
    margin-top: 15px;
    margin-bottom: 5px;
    overflow: hidden;
}
#timerProgressBar {
    width: 0;
    height: 100%;
    background: linear-gradient(90deg, #00ffaa, #00aaff);
    border-radius: 3px;
    /* transition property will be set/unset via JS to control the animation */
}
#timerProgressBar.active {
    width: 100%;
    transition: width 2.1s linear; /* Total duration of word separator (3 x 0.7s) */
}

/* å…§å®¹å€ */
.content{max-width:1000px;padding:20px;margin-top:10px;color:#dceefc;line-height:1.8;z-index:2}
.content h3{color:#bff; margin-top:18px}
.morse-table{width:100%;border-collapse:collapse;margin-top:12px}
.morse-table td,.morse-table th{border:1px solid rgba(255,255,255,0.06);padding:8px;text-align:center;font-size:14px;color:#dceefc}

/* æ‘©æ–¯è¡¨æ ¼å¡ç‰‡æ¨£å¼ */
#morse-table-card {
    width: 100%;
    max-width: 800px; /* è®“è¡¨æ ¼å¡ç‰‡æ›´å¯¬ */
    padding: 20px;
}
#morse-table-card h2 {
    text-align: center;
    margin-bottom: 20px;
}
#morse-table-card .morse-table {
    width: 100%;
}

/* Footer æ¨£å¼èª¿æ•´ */
footer{
    color: rgba(255, 255, 255, 0.6);
    font-size: 14px;
    padding: 20px;
    text-align: center;
    line-height: 1.6;
    margin-top: 20px;
}
footer a{
    color: #00ccff;
    text-decoration: none;
    transition: color 0.3s;
}
footer a:hover{
    color: #00ffaa;
}

/* æ‰‹æ©Ÿç‰ˆå–®æ¬„ */
@media(max-width:767px){
Â  .ad-left,.ad-right{display:none}
Â  .card{width:90%}
}
</style>
</head>
<body>

<div class="ad-top">
Â  <ins class="adsbygoogle"
Â  Â  Â  Â style="display:block"
Â  Â  Â  Â data-ad-client="ca-pub-6741848109234929"
Â  Â  Â  Â data-ad-slot="1111111111"
Â  Â  Â  Â data-ad-format="auto"
Â  Â  Â  Â data-full-width-responsive="true"></ins>
Â  <script>(adsbygoogle = window.adsbygoogle || []).push({});</script>
</div>

<div class="ad-left">å·¦å´å»£å‘Šä½</div>
<div class="ad-right">å³å´å»£å‘Šä½</div>

<div class="content">
Â  <h2>é—œæ–¼ Morse Beat</h2>
Â  <p>Morse Beat æ˜¯çµåˆæ‘©æ–¯ç¢¼èˆ‡éŸ³æ¨‚ç¯€å¥çš„å‰µæ„å·¥å…·ã€‚å¯å°‡æ–‡å­—è½‰æ›ç‚ºæ‘©æ–¯ç¢¼ç¯€å¥,æ’­æ”¾éŸ³è¨Š,ä¸¦ç”Ÿæˆé©šå–œé€£çµèˆ‡æœ‹å‹åˆ†äº«ã€‚</p>
Â  <h3>æ‘©æ–¯é›»ç¢¼çš„èµ·æºèˆ‡ç™¼å±•</h3>
Â  <p>æ‘©æ–¯é›»ç¢¼ç”± Samuel Morse èˆ‡ Alfred Vail åœ¨ 1830 å¹´ä»£ç™¼å±•,ç”¨æ–¼é›»å ±ç³»çµ±ã€‚çŸ­è„ˆè¡èˆ‡é•·è„ˆè¡åˆ†åˆ¥ä»£è¡¨å­—æ¯æˆ–æ•¸å­—,æ˜¯è·¨æ™‚ä»£çš„é‡è¦é€šè¨Šæ–¹å¼ã€‚</p>
Â  <h3>æ‘©æ–¯èˆ‡éŸ³æ¨‚ï¼šç¯€å¥åŒ–çš„è¨Šè™Ÿ</h3>
Â  <p>æ‘©æ–¯ç¢¼æœ¬è³ªç‚ºç¯€å¥èªè¨€ï¼šçŸ­éŸ³ï¼ˆÂ·ï¼‰ç­‰åŒçŸ­æ‹,é•·éŸ³ï¼ˆâˆ’ï¼‰ç­‰åŒé•·æ‹,å­—æ¯é–“åœé “åƒå°ç¯€åˆ†éš”ã€‚å¯æ˜ å°„è‡³é¼“é»æˆ–åˆæˆå™¨,å‰µé€ éŸ³æ¨‚ç¯€å¥çš„è¨Šè™Ÿè—è¡“ã€‚</p>
Â  <h3>ç¶²ç«™åŠŸèƒ½ä»‹ç´¹</h3>
Â  <ul>
Â  Â  <li>æ–‡å­—è½‰æ‘©æ–¯,æ’­æ”¾ç¯€å¥éŸ³è¨Š</li>
Â  Â  <li>æ‘©æ–¯ç¢¼è¤‡è£½èˆ‡ç”Ÿæˆé©šå–œé€£çµåˆ†äº«</li>
Â  Â  <li>å³æ™‚æ‰“æ‘©æ–¯åŠŸèƒ½ï¼ˆæ”¯æ´éµç›¤èˆ‡å³æ™‚éŸ³æ•ˆï¼‰</li>
Â  Â  <li>è§£ç¢¼å€,è¼¸å…¥æ‘©æ–¯ç¢¼ç²å¾—æ–‡å­—çµæœ</li>
Â  Â  <li>æ­·å²èˆ‡å­¸ç¿’å€,ä»‹ç´¹æ‘©æ–¯ç¢¼èµ·æºèˆ‡æ‡‰ç”¨</li>
Â  </ul>
</div>

<div class="container">
Â  Â  <div class="card">
Â  Â  <h1>ğŸµ Morse Beat</h1>
Â  Â  <input type="text" id="textInput" placeholder="è¼¸å…¥æ–‡å­—..." />
Â  Â  <div class="output" id="morseOutput">ç­‰å¾…è¼¸å…¥...</div>
Â  Â  <div>
Â  Â  Â  <button id="convertBtn">è½‰æ›</button>
Â  Â  Â  <button id="playBtn">æ’­æ”¾ç¯€å¥</button>
Â  Â  Â  <button id="stopBtn">åœæ­¢</button>
Â  Â  Â  <button class="copy-btn" onclick="copyText('morseOutput')">è¤‡è£½æ‘©æ–¯ç¢¼</button>
Â  Â  Â  <button class="share-btn" onclick="shareUrl('morseOutput')">åˆ†äº«æ‘©æ–¯ç¢¼ï¼ˆé©šå–œé€£çµï¼‰</button>
Â  Â  </div>
Â  Â  <p style="font-size:12px;margin-top:10px;">**è¼¸å‡ºä½¿ç”¨æ¨™æº–ç©ºæ ¼åˆ†éš”å­—æ¯**</p>
Â  </div>

Â  Â  <div class="card">
Â  Â  <h2>ğŸ” è§£ç¢¼å€</h2>
Â  Â  <textarea id="decodeInput" rows="4" placeholder="è¼¸å…¥æ‘©æ–¯ç¢¼ï¼ˆä¾‹å¦‚ï¼š.... . .-.. .-.. --- / .-- --- .-. .-.. -..ï¼‰"></textarea>
Â  Â  <div class="output" id="decodeOutput">ç­‰å¾…è§£ç¢¼...</div>
Â  Â  <div>
Â  Â  Â  <button id="decodeBtn">è§£ç¢¼</button>
Â  Â  Â  <button class="copy-btn" onclick="copyText('decodeOutput')">è¤‡è£½è§£ç¢¼æ–‡å­—</button>
Â  Â  Â  <button class="share-btn" onclick="shareUrl('decodeOutput', true)">åˆ†äº«æ–‡å­—ï¼ˆé©šå–œé€£çµï¼‰</button>
Â  Â  Â  <p style="font-size:12px;margin-top:10px;">**æ³¨æ„ï¼šå­—æ¯é–“ç”¨ç©ºæ ¼åˆ†éš”ï¼Œå–®å­—é–“ç”¨ `/` åˆ†éš”**</p>
Â  Â  </div>
Â  </div>

Â  Â  <div class="card">
Â  Â  <h2>âš¡ æ‰“ Morse Beat</h2>
    <p>é»æ“ŠæŒ‰éˆ•æˆ–æŒ‰ **[ç©ºç™½éµ]**</p>
Â  Â  <p>é»ä¸€ä¸‹ â†’ çŸ­é»ã€ŒÂ·ã€ | é•·æŒ‰ >0.5ç§’ â†’ é•·é»ã€Œâˆ’ã€</p>
    <p>åœé “ **0.7 ç§’** â†’ å­—æ¯åˆ†éš” (ç©ºæ ¼)</p>
    <p>åœé “ **2.1 ç§’** â†’ å–®å­—åˆ†éš” (æ–œç·š ` / `)</p>
Â  Â  <button id="beatBtn">ğŸµ æ‰“æ‘©æ–¯</button>
Â  Â  <div class="output" id="liveMorse">ç›®å‰æ‘©æ–¯ç¢¼ï¼š </div>
    
    <div class="output" id="liveDecode" style="min-height: 25px; color: #00ffaa; font-size: 15px; padding: 8px;">å³æ™‚è§£ç¢¼ï¼š</div> 

    <div id="timerProgressContainer">
        <div id="timerProgressBar"></div>
    </div>

Â  Â  <button onclick="clearLiveMorse()">æ¸…é™¤</button>
    <button class="copy-btn" onclick="copyLiveMorse()">è¤‡è£½</button>
Â  </div>
</div>

<div class="card" id="morse-table-card">
  <h2>æ‘©æ–¯ç¢¼åƒè€ƒè¡¨ (Aâ€“Z, 0â€“9)</h2>
  <table class="morse-table">
Â  Â  <thead><tr><th>ç¬¦è™Ÿ</th><th>æ‘©æ–¯</th><th>ç¬¦è™Ÿ</th><th>æ‘©æ–¯</th></tr></thead>
Â  Â  <tbody>
Â  Â  Â  <tr><td>A</td><td>.-</td><td>N</td><td>-.</td></tr>
Â  Â  Â  <tr><td>B</td><td>-...</td><td>O</td><td>---</td></tr>
Â  Â  Â  <tr><td>C</td><td>-.-.</td><td>P</td><td>.--.</td></tr>
Â  Â  Â  <tr><td>D</td><td>-..</td><td>Q</td><td>--.-</td></tr>
Â  Â  Â  <tr><td>E</td><td>.</td><td>R</td><td>.-.</td></tr>
Â  Â  Â  <tr><td>F</td><td>..-.</td><td>S</td><td>...</td></tr>
Â  Â  Â  <tr><td>G</td><td>--.</td><td>T</td><td>-</td></tr>
Â  Â  Â  <tr><td>H</td><td>....</td><td>U</td><td>..-</td></tr>
Â  Â  Â  <tr><td>I</td><td>..</td><td>V</td><td>...-</td></tr>
Â  Â  Â  <tr><td>J</td><td>.---</td><td>W</td><td>.--</td></tr>
Â  Â  Â  <tr><td>K</td><td>-.-</td><td>X</td><td>-..-</td></tr>
Â  Â  Â  <tr><td>L</td><td>.-..</td><td>Y</td><td>-.--</td></tr>
Â  Â  Â  <tr><td>M</td><td>--</td><td>Z</td><td>--..</td></tr>
Â  Â  Â  <tr><td>0</td><td>-----</td><td>5</td><td>.....</td></tr>
Â  Â  Â  <tr><td>1</td><td>.----</td><td>6</td><td>-....</td></tr>
Â  Â  Â  <tr><td>2</td><td>..---</td><td>7</td><td>--...</td></tr>
Â  Â  Â  <tr><td>3</td><td>...--</td><td>8</td><td>---..</td></tr>
Â  Â  Â  <tr><td>4</td><td>....-</td><td>9</td><td>----.</td></tr>
Â  Â  </tbody>
Â  </table>
</div>


<div class="ad-bottom">
Â  <ins class="adsbygoogle"
Â  Â  Â  Â style="display:block"
Â  Â  Â  Â data-ad-client="ca-pub-6741848109234929"
Â  Â  Â  Â data-ad-slot="2222222222"
Â  Â  Â  Â data-ad-format="auto"
Â  Â  Â  Â data-full-width-responsive="true"></ins>
Â  <script>(adsbygoogle = window.adsbygoogle || []).push({});</script>
</div>

<footer>Â© 2025 Morse Beat ï½œ <a href="/privacy">éš±ç§æ”¿ç­–</a> ï½œ <a href="/contact">è¯çµ¡æˆ‘å€‘</a><br>æœ¬ç¶²ç«™ä½¿ç”¨ Google AdSense æä¾›å»£å‘Šæœå‹™</footer>

<div id="toast" class="toast">âœ… å·²è¤‡è£½ï¼</div>

<script>
// ===== æ‘©æ–¯ç¢¼å­—å…¸ =====
const MORSE={A:".-",B:"-...",C:"-.-.",D:"-..",E:".",F:"..-.",G:"--.",H:"....",I:"..",J:".---",K:"-.-",L:".-..",M:"--",N:"-.",O:"---",P:".--.",Q:"--.-",R:".-.",S:"...",T:"-",U:"..-",V:"...-",W:".--",X:"-..-",Y:"-.--",Z:"--..","1":".----","2":"..---","3":"...--","4":"....-","5":".....","6":"-....","7":"--...","8":"---..","9":"----.","0":"-----"," ":"/"};
const REVERSE=Object.fromEntries(Object.entries(MORSE).map(([k,v])=>[v,k]));
const MORSE_UNIT_TIME = 0.15; // æ‘©æ–¯ç¢¼åŸºç¤æ™‚é–“å–®ä½ (ç§’)

// å…ƒä»¶
const textInput=document.getElementById("textInput");
const morseOutput=document.getElementById("morseOutput");
const convertBtn=document.getElementById("convertBtn");
const playBtn=document.getElementById("playBtn");
const stopBtn=document.getElementById("stopBtn");
const decodeInput=document.getElementById("decodeInput");
const decodeOutput=document.getElementById("decodeOutput");
const decodeBtn=document.getElementById("decodeBtn");
const liveMorse=document.getElementById("liveMorse");
const liveDecode = document.getElementById("liveDecode"); // NEW
const beatBtn=document.getElementById("beatBtn");
const timerProgressBar = document.getElementById("timerProgressBar"); // NEW

// éŸ³è¨Šä¸Šä¸‹æ–‡
let audioCtx;
function initAudio() {
    if (!audioCtx) {
        audioCtx = new (window.AudioContext || window.webkitContext)();
    }
}
document.addEventListener('click', initAudio, {once: true});
document.addEventListener('keydown', initAudio, {once: true}); 

let playing=false;

// æ‘©æ–¯æŒ‰éˆ•è¼¸å…¥å¸¸æ•¸èˆ‡è¨ˆæ™‚å™¨ (ç¶­æŒå„ªåŒ–å¾Œçš„æ™‚é–“)
const LIVE_SEPARATOR_TIMEOUT = 700; // 0.7ç§’: å­—æ¯é–“éš” (space)
const WORD_SEPARATOR_TIMEOUT = 2100; // 2.1ç§’: å–®è©é–“éš” (slash)
let letterSeparatorTimer; 
let wordSeparatorTimer;   

// æ‘©æ–¯ç¢¼è½‰æ›é‚è¼¯ - ä½¿ç”¨ç©ºæ ¼
function textToMorse(t){
    return t.toUpperCase().split("").map(c=>MORSE[c]||"").join(" ");
}

// å„ªåŒ–å¾Œçš„è§£ç¢¼é‚è¼¯ (é«˜åº¦å®¹éŒ¯æ€§)
function morseToText(m){
    // 1. ç§»é™¤è¼¸å…¥å­—ä¸²å°¾éƒ¨çš„å–®å­—åˆ†éš”ç¬¦(/)åŠå…¶å‘¨åœçš„ç©ºæ ¼ã€‚
    let cleanedInput = m.replace(/\s*\/\s*$/, "").trim(); 

    // 2. æ­£è¦åŒ–å­—ä¸²ä¸­çš„å–®å­—åˆ†éš”ç¬¦ï¼šå°‡æ‰€æœ‰å¯èƒ½çš„æ–œç·šæ ¼å¼æ›¿æ›æˆæ¨™æº–çš„ " / "
    let cleanMorse = cleanedInput.replace(/\s*\/\s*/g, " / "); 
    
    // 3. æ­£è¦åŒ–å­—æ¯åˆ†éš”ç¬¦ï¼šæ¸…ç†å¤šé¤˜çš„ç©ºæ ¼ï¼Œç¢ºä¿å­—æ¯é–“åªæœ‰ä¸€å€‹ç©ºæ ¼
    cleanMorse = cleanMorse.replace(/\|/g, " "); // ä»ç„¶å®¹è¨±èˆŠçš„ | ç¬¦è™Ÿ
    cleanMorse = cleanMorse.replace(/\s+/g, " ").trim(); // æ¸…ç†å¤šé¤˜çš„ç©ºæ ¼

    // å¦‚æœæ¸…ç†å¾Œå­—ä¸²ç‚ºç©ºï¼Œç›´æ¥è¿”å›ç©º
    if (cleanMorse === "") return ""; 

    // 4. é€²è¡Œè§£ç¢¼
    return cleanMorse
        .split(" / ") // ä¾æ¨™æº–çš„ " / " åˆ†å‰²å–®å­—
        .map(w => 
            w.split(" ") // ä¾å–®ä¸€ç©ºæ ¼åˆ†å‰²å­—æ¯
            .map(s => REVERSE[s]||"") 
            .join("")
        )
        .join(" "); // å–®å­—é–“ä»¥ç©ºæ ¼åˆä½µ
}

convertBtn.onclick=()=>{morseOutput.textContent=textToMorse(textInput.value.trim())||"ï¼ˆç„¡æ•ˆè¼¸å…¥ï¼‰";}
decodeBtn.onclick=()=>{decodeOutput.textContent=morseToText(decodeInput.value.trim())||"ï¼ˆç„¡æ³•è§£ç¢¼æˆ–æ‘©æ–¯ç¢¼éŒ¯èª¤ï¼‰";}

// æ‘©æ–¯ç¢¼æ’­æ”¾é‚è¼¯ (ç•¥)
function beep(start,d){
    if(!audioCtx) return;
    const o=audioCtx.createOscillator(),g=audioCtx.createGain();
    o.type="sine";
    o.frequency.setValueAtTime(600,audioCtx.currentTime);
    o.connect(g);
    g.connect(audioCtx.destination);
    o.start(start);
    o.stop(start+d);
}

function flash(){
    morseOutput.classList.add("flash");
    setTimeout(()=>morseOutput.classList.remove("flash"),100)
}

function playMorse(m){
    if(!m || playing || !audioCtx) return;
    playing=true;
    const unit=MORSE_UNIT_TIME;
    let time=audioCtx.currentTime;
    
    // æ’­æ”¾å‰åªæ¸…ç†ç„¡æ•ˆå­—ç¬¦
    const cleanedMorse = m.replace(/[^.\-/\s]/g, '').trim(); 

    cleanedMorse.split("").forEach(s=>{
        if(s==="."){
            beep(time,unit);
            flash();
            time+=unit*2;
        } else if(s==="-"){
            beep(time,unit*3);
            flash();
            time+=unit*4;
        } else if(s===" "){
            time+=unit*2;
        } else if(s==="/"){
            time+=unit*6;
        }
    });
    setTimeout(()=>{playing=false;},(time-audioCtx.currentTime)*1000);
}

playBtn.onclick=()=>{
    const m=morseOutput.textContent.trim();
    if(m&&m!=="ç­‰å¾…è¼¸å…¥...") playMorse(m);
};

stopBtn.onclick=()=>{
    if(audioCtx) {
        audioCtx.close().then(() => audioCtx = new (window.AudioContext || window.webkitContext)());
    }
    playing=false;
};

// è¤‡è£½èˆ‡æç¤º (ç•¥)
function copyText(id){
    const t=document.getElementById(id).textContent.trim();
    if(!t||t.startsWith("ç­‰å¾…")) return;
    navigator.clipboard.writeText(t);
    showToast("âœ… å·²è¤‡è£½ï¼")
}

function showToast(msg){
    const toast=document.getElementById("toast");
    toast.textContent=msg;
    toast.classList.add("show");
    setTimeout(()=>toast.classList.remove("show"),1500)
}

function shareUrl(id, isText = false){
    const t=document.getElementById(id).textContent.trim();
    if(!t||t.startsWith("ç­‰å¾…")) return;
    let paramValue = isText ? textToMorse(t) : t;
    const url=location.origin+location.pathname+"?m="+encodeURIComponent(paramValue);
    navigator.clipboard.writeText(url);
    showToast("ğŸ”— é©šå–œé€£çµå·²è¤‡è£½ï¼")
}

// ===== æ‘©æ–¯æŒ‰éˆ•è¼¸å…¥é‚è¼¯ (Live Beat) =====

let liveStr="";
let pressTimer;
let isKeyPressed = false; 

function playLiveBeep(type) {
    if (!audioCtx) {
        console.warn("AudioContext not ready.");
        return;
    }
    const unit = MORSE_UNIT_TIME;
    const duration = (type === 'dot' ? unit : unit * 3);
    const o = audioCtx.createOscillator(), g = audioCtx.createGain();
    o.type = "sine";
    o.frequency.setValueAtTime(600, audioCtx.currentTime);
    o.connect(g);
    g.connect(audioCtx.destination);
    o.start(audioCtx.currentTime);
    o.stop(audioCtx.currentTime + duration);
}

function copyLiveMorse() {
    const t = liveStr.trim();
    if (!t) return;
    navigator.clipboard.writeText(t);
    showToast("âœ… å·²è¤‡è£½ï¼");
}

function realtimeDecode() { // NEW
    const decoded = morseToText(liveStr.trim());
    liveDecode.textContent = "å³æ™‚è§£ç¢¼ï¼š" + (decoded || "...");
}

function clearTimers() {
    if (letterSeparatorTimer) clearTimeout(letterSeparatorTimer);
    if (wordSeparatorTimer) clearTimeout(wordSeparatorTimer);
    letterSeparatorTimer = null;
    wordSeparatorTimer = null;
    
    // Reset Progress Bar
    timerProgressBar.classList.remove('active');
    // Force reflow/repaint to reset the animation immediately
    void timerProgressBar.offsetWidth; 
    timerProgressBar.style.width = '0';
}

function startSeparatorTimer() {
    clearTimers();

    // Start Progress Bar Animation
    timerProgressBar.style.transition = 'none'; 
    timerProgressBar.style.width = '0';
    // Force reflow
    void timerProgressBar.offsetWidth; 
    
    timerProgressBar.style.transition = `width ${WORD_SEPARATOR_TIMEOUT/1000}s linear`;
    timerProgressBar.classList.add('active');


    letterSeparatorTimer = setTimeout(() => {
        if (liveStr.trim() !== "" && liveStr.slice(-1) !== " " && liveStr.slice(-1) !== "/") {
            liveStr += " "; 
            liveMorse.textContent = "ç›®å‰æ‘©æ–¯ç¢¼ï¼š" + liveStr; 
            realtimeDecode(); // Decode after space is added
            
            wordSeparatorTimer = setTimeout(() => {
                if (liveStr.slice(-1) === " ") {
                    liveStr = liveStr.slice(0, -1) + "/"; 
                    liveMorse.textContent = "ç›®å‰æ‘©æ–¯ç¢¼ï¼š" + liveStr; 
                    realtimeDecode(); // Decode after slash is added
                }
                wordSeparatorTimer = null; 
            }, WORD_SEPARATOR_TIMEOUT - LIVE_SEPARATOR_TIMEOUT);
        }
        letterSeparatorTimer = null; 
    }, LIVE_SEPARATOR_TIMEOUT); 
}

// ä¿®æ­£å¾Œçš„ Live Morse æ›´æ–°é‚è¼¯ (è™•ç†è¨ˆæ™‚å’Œè§£ç¢¼)
function updateLiveMorse(symbol) {
    clearTimers(); // Clear timers (resets progress bar)
    
    liveStr += symbol; 
    liveMorse.textContent = "ç›®å‰æ‘©æ–¯ç¢¼ï¼š" + liveStr; 
    realtimeDecode(); // Decode after symbol is added
    startSeparatorTimer(); // Start new timer (starts progress bar)
}


// é–‹å§‹æŒ‰å£“ (æ»‘é¼ æˆ–éµç›¤)
function startPress(e){
    const activeEl = document.activeElement;
    if (activeEl.tagName === 'INPUT' || activeEl.tagName === 'TEXTAREA') {
        return;
    }
    e.preventDefault();
    
    if (isKeyPressed) return;
    isKeyPressed = true;
    
    beatBtn.classList.add('active');

    pressTimer = setTimeout(()=>{
        pressTimer = null;
        updateLiveMorse("-");
        playLiveBeep('dash');
    }, 500);
}

// çµæŸæŒ‰å£“ (æ»‘é¼ æˆ–éµç›¤)
function endPress(e){
    const activeEl = document.activeElement;
    if (activeEl.tagName === 'INPUT' || activeEl.tagName === 'TEXTAREA') {
        return;
    }
    e.preventDefault();
    
    if (!isKeyPressed) return;
    isKeyPressed = false;
    
    beatBtn.classList.remove('active');

    if(pressTimer){
        clearTimeout(pressTimer);
        pressTimer = null;
        updateLiveMorse(".");
        playLiveBeep('dot');
    }
}

// æ¸…é™¤å³æ™‚æ‘©æ–¯ç¢¼
function clearLiveMorse(){
    liveStr="";
    liveMorse.textContent="ç›®å‰æ‘©æ–¯ç¢¼ï¼š";
    liveDecode.textContent = "å³æ™‚è§£ç¢¼ï¼š"; // Clear decode output
    clearTimers();
    
    isKeyPressed = false;
    if (pressTimer) {
        clearTimeout(pressTimer);
        pressTimer = null;
    }
    beatBtn.classList.remove('active');
}

// ç¶å®šäº‹ä»¶
beatBtn.addEventListener("mousedown",startPress);
beatBtn.addEventListener("mouseup",endPress);
beatBtn.addEventListener("mouseleave",endPress); 
beatBtn.addEventListener("touchstart",startPress);
beatBtn.addEventListener("touchend",endPress);

document.addEventListener("keydown", (e) => {
    if (e.code === "Space") {
        startPress(e);
    }
});
document.addEventListener("keyup", (e) => {
    if (e.code === "Space") {
        endPress(e);
    }
});

// è™•ç† URL åƒæ•¸ (ç•¥)
function checkUrlParams() {
    const params = new URLSearchParams(window.location.search);
    const morseCode = params.get('m');
    
    if ( morseCode ) {
        decodeInput.value = decodeURIComponent(morseCode).trim();
        decodeOutput.textContent = morseToText(decodeInput.value) || "ï¼ˆç„¡æ³•è§£ç¢¼çš„æ‘©æ–¯ç¢¼ï¼‰";
        showToast("ğŸ æ”¶åˆ°é©šå–œæ‘©æ–¯è¨Šæ¯ï¼");
    }
}

document.addEventListener('DOMContentLoaded', checkUrlParams);
</script>
</body>
</html>